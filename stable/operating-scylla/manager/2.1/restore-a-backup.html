

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Restore a Backup | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../../../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../../../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../../../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../../../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../../../_static/img/favicon-228x228.png" />

        
            
            
        

        
            
            <link rel="canonical" href="https://docs.scylladb.com/stable/operating-scylla/manager/2.1/restore-a-backup.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../../../"
            src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../../../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../../../_static/underscore.js"></script>
            
        
            
                <script src="../../../_static/doctools.js"></script>
            
        
            
                <script src="../../../_static/clipboard.min.js"></script>
            
        
            
                <script src="../../../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../../../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../../../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="../../../index.html"
            class="bread__highlight">
            <i class="fas fa-home"></i> ScyllaDB Open Source
        </a>
    </span>
    
    <span class="bread__item bread__item--last">Restore a Backup</span>
</div>
                    </div>
                
                <section id="restore-a-backup">
<h1>Restore a Backup<a class="headerlink" href="#restore-a-backup" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You are not reading the most recent version of this documentation.
Go to the <strong>latest</strong> version of <a class="reference external" href="http://scylladb.github.io/scylla-manager/">Scylla Manager Documentation</a>.</p>
</div>
<p>This document provides information on how to restore data from backups that were taken using the Scylla Manager.</p>
<p>There are two restore scenarios:</p>
<ol class="arabic simple">
<li><p>Backup to the same topology cluster.
For example, restore data to the same source cluster.</p></li>
<li><p>Backup to a different topology cluster.
For example, restore data to a smaller or bigger cluster, a cluster with a different rack or DC topology, or different token distribution.</p></li>
</ol>
<p><strong>Workflow</strong></p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#prepare-for-restore">Prepare for restore</a></p></li>
<li><p><a class="reference internal" href="#upload-data-to-scylla">Upload data to Scylla</a></p></li>
</ol>
<section id="prepare-for-restore">
<h2>Prepare for restore<a class="headerlink" href="#prepare-for-restore" title="Permalink to this headline">¶</a></h2>
<p>No matter which backup scenario you are using, the procedures in this workflow apply.</p>
<p><strong>Workflow</strong></p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#make-sure-scylla-cluster-is-up">Make sure Scylla cluster is up</a></p></li>
<li><p><a class="reference internal" href="#install-scylla-manager">Install Scylla Manager</a></p></li>
<li><p><a class="reference internal" href="#register-the-cluster-with-the-scylla-manager">Register the cluster with the Scylla Manager</a></p></li>
<li><p><a class="reference internal" href="#identify-relevant-snapshot">Identify relevant snapshot</a></p></li>
<li><p><a class="reference internal" href="#restore-the-schema">Restore the schema</a></p></li>
</ol>
<section id="make-sure-scylla-cluster-is-up">
<h3>Make sure Scylla cluster is up<a class="headerlink" href="#make-sure-scylla-cluster-is-up" title="Permalink to this headline">¶</a></h3>
<p>Make sure that your Scylla cluster is up and that there are no issues with networking, disk space, or memory.
If you need help, you can check official documentation on <a class="reference internal" href="../../procedures/cluster-management/index.html"><span class="doc">operational procedures for cluster management</span></a>.</p>
</section>
<section id="install-scylla-manager">
<h3>Install Scylla Manager<a class="headerlink" href="#install-scylla-manager" title="Permalink to this headline">¶</a></h3>
<p>You need a working Scylla Manager setup to list backups. If you don’t have it installed, please follow official instructions on <a class="reference external" href="../install/">how to install Scylla Manager</a> first.</p>
<p>Nodes must have access to the locations of the backups as per instructions in the official documentation for <a class="reference internal" href="install-agent.html#manager-2-1-prepare-nodes-for-backup"><span class="std std-ref">installing Scylla Manager Agent</span></a>.</p>
</section>
<section id="register-the-cluster-with-the-scylla-manager">
<h3>Register the cluster with the Scylla Manager<a class="headerlink" href="#register-the-cluster-with-the-scylla-manager" title="Permalink to this headline">¶</a></h3>
<p>This section only applies to situations where a registered cluster that was originally used for the backup is missing from the Scylla Manager.
In that case, a new cluster must be registered before you can access the backups created with the old one.
This example demonstrates adding a cluster named “cluster1” with initial node IP 18.185.31.99, instructs Scylla Manager not to schedule a default repair, and  forcing uuid of the new cluster to ebec29cd-e768-4b66-aac3-8e8943bcaa76:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sctool cluster add --host 18.185.31.99 --name cluster1 --without-repair -id ebec29cd-e768-4b66-aac3-8e8943bcaa76
ebec29cd-e768-4b66-aac3-8e8943bcaa76
__
/  \     Cluster added! You can set it as default, by exporting its name or ID as env variable:
@  @     $ export SCYLLA_MANAGER_CLUSTER=ebec29cd-e768-4b66-aac3-8e8943bcaa76
|  |     $ export SCYLLA_MANAGER_CLUSTER=cluster1
|| |/
|| ||    Now run:
|\_/|    $ sctool status -c cluster1
\___/    $ sctool task list -c cluster1
</pre></div>
</div>
</div></blockquote>
<p>Cluster is created, and we can proceed to list old backups.
If the uuid of the old cluster is lost, there is a workaround with <code class="docutils literal notranslate"><span class="pre">--all-clusters</span></code> parameter.
In that case, just register the cluster and proceed to the next step.</p>
</section>
<section id="identify-relevant-snapshot">
<h3>Identify relevant snapshot<a class="headerlink" href="#identify-relevant-snapshot" title="Permalink to this headline">¶</a></h3>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>List all available backups and choose the one you would like to restore.
Run: <a class="reference internal" href="sctool.html#sctool-backup-list"><span class="std std-ref">sctool backup list</span></a>, to lists all backups for the cluster.
This command will list backups only created with provided cluster (<code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">clust1</span></code>).
If you don’t have uuid of the old cluster, you can use <code class="docutils literal notranslate"><span class="pre">--all-clusters</span></code> to list all backups from all clusters that are available in the target location:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sctool backup list -c cluster1 --all-clusters -L s3:backup-bucket
Cluster: 7313fda0-6ebd-4513-8af0-67ac8e30077b

Snapshots:
- sm_20200513131519UTC (563.07GiB)
- sm_20200513080459UTC (563.07GiB)
- sm_20200513072744UTC (563.07GiB)
- sm_20200513071719UTC (563.07GiB)
- sm_20200513070907UTC (563.07GiB)
- sm_20200513065522UTC (563.07GiB)
- sm_20200513063046UTC (563.16GiB)
- sm_20200513060818UTC (534.00GiB)
Keyspaces:
- system_auth (4 tables)
- system_distributed (2 tables)
- system_schema (12 tables)
- system_traces (5 tables)
- user_data (100 tables)
</pre></div>
</div>
<p>Here, for example, we have eight different snapshots to choose from.
Snapshot tags encode the date they were taken in UTC time zone.
For example, <code class="docutils literal notranslate"><span class="pre">sm_20200513131519UTC</span></code> was taken on 13/05/2020 at 13:15 and 19 seconds UTC.
The data source for the listing is the cluster backup locations.
Listing may take some time, depending on how big the cluster is and how many backups there are.</p>
</li>
</ol>
</section>
<section id="restore-the-schema">
<span id="restore-backup-restore-schema"></span><h3>Restore the schema<a class="headerlink" href="#restore-the-schema" title="Permalink to this headline">¶</a></h3>
<p>Scylla Manager 2.1 can store schema with your backup.
To extract schema files for each keyspace from the backup, please refer to the official documentation for <a class="reference external" href="../../2.1/extract-schema-from-backup">extracting schema from the backup</a>. For convenience, here is the continuation of our example with the list of steps for restoring schema:</p>
<ol class="arabic">
<li><p>Download schema from the backup store to the current dir. It’s in the first line of the <code class="docutils literal notranslate"><span class="pre">backup_files.out</span></code> output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sctool backup files --cluster my-cluster -L s3:backup-bucket -T sm_20200513104924UTC --with-version | head -n 1 | xargs -n2 aws s3 cp
download: s3://backup-bucket/backup/schema/cluster/7313fda0-6ebd-4513-8af0-67ac8e30077b/task_001ce624-9ac2-4076-a502-ec99d01effe4_tag_sm_20200513104924UTC_schema.tar.gz to ./task_001ce624-9ac2-4076-a502-ec99d01effe4_tag_sm_20200513104924UTC_schema.tar.gz
</pre></div>
</div>
</li>
<li><p>Extract schema files by decompressing archive:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mkdir ./schema
tar -xf task_001ce624-9ac2-4076-a502-ec99d01effe4_tag_sm_20200513104924UTC_schema.tar.gz -C ./schema
ls ./schema
system_auth.cql  system_distributed.cql  system_schema.cql  system_traces.cql  user_data.cql
</pre></div>
</div>
</li>
</ol>
<ul class="simple">
<li><p>If you do <em>not</em> have the schema file available, you can <a class="reference external" href="https://manager.docs.scylladb.com/branch-2.2/restore/extract-schema-from-metadata.html">extract the schema from system table</a>.</p></li>
</ul>
<p>Full schema restore procedure can be found at <a class="reference internal" href="../../procedures/backup-restore/restore.html#restore-procedure"><span class="std std-ref">steps 1 to 5</span></a>.
For convenience, here is the list of steps for our example (WARNING: these can be destructive operations):</p>
<ol class="arabic">
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">nodetool</span> <span class="pre">drain</span></code> command to ensure the data is flushed to the SSTables.</p></li>
<li><p>Shut down the node:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop scylla-server
</pre></div>
</div>
</li>
<li><p>Delete all files in the commitlog:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo rm -rf /var/lib/scylla/commitlog/*
</pre></div>
</div>
</li>
<li><p>Delete all the files in the user_data.data_* tables (only files, not directories):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo rm -f  /var/lib/scylla/data/user_data/data_0-6e856600017f11e790f4000000000000/*
</pre></div>
</div>
</li>
</ol>
<p>If cluster is added with CQL credentials (see <a class="reference internal" href="add-a-cluster.html"><span class="doc">Add Cluster</span></a> for reference) Scylla Manager would backup schema in CQL format.
To obtain CQL schema from a particular backup, use <code class="docutils literal notranslate"><span class="pre">sctool</span> <span class="pre">backup</span> <span class="pre">files</span></code> command, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sctool backup files -c my-cluster -L s3:backups -T sm_20191210145143UTC
</pre></div>
</div>
<p>The first output line is a path to schemas archive, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>s3://backups/backup/schema/cluster/ed63b474-2c05-4f4f-b084-94541dd86e7a/task_287791d9-c257-4850-aef5-7537d6e69d90_tag_sm_20200506115612UTC_schema.tar.gz      ./
</pre></div>
</div>
<p>This archive contains a single CQL file for each keyspace in the backup.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tar -ztvf task_287791d9-c257-4850-aef5-7537d6e69d90_tag_sm_20200506115612UTC_schema.tar.gz
-rw------- 0/0            2366 2020-05-08 14:38 system_auth.cql
-rw------- 0/0             931 2020-05-08 14:38 system_distributed.cql
-rw------- 0/0           11557 2020-05-08 14:38 system_schema.cql
-rw------- 0/0            4483 2020-05-08 14:38 system_traces.cql
</pre></div>
</div>
<p>To restore the schema, you need to execute the files with cqlsh command.</p>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Download schema archive</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>aws s3 cp s3://backups/backup/schema/cluster/ed63b474-2c05-4f4f-b084-94541dd86e7a/task_287791d9-c257-4850-aef5-7537d6e69d90_tag_sm_20200506115612UTC_schema.tar.gz ./
</pre></div>
</div>
</li>
<li><p>Extract CQL files from archive</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tar -xzvf task_287791d9-c257-4850-aef5-7537d6e69d90_tag_sm_20200506115612UTC_schema.tar.gz
</pre></div>
</div>
</li>
<li><p>Copy CQL files for desired keyspaces to a cluster node</p></li>
<li><p>On node execute CQL files using cqlsh</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cqlsh -f my_keyspace.cql
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="upload-data-to-scylla">
<h2>Upload data to Scylla<a class="headerlink" href="#upload-data-to-scylla" title="Permalink to this headline">¶</a></h2>
<p>You can either upload the data:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#to-the-same-cluster">To the same cluster</a>: with the same nodes, topology, and the same token distribution <strong>OR</strong></p></li>
<li><p><a class="reference internal" href="#to-a-new-cluster">To a new cluster</a>: of any number of nodes</p></li>
</ul>
<section id="to-the-same-cluster">
<h3>To the same cluster<a class="headerlink" href="#to-the-same-cluster" title="Permalink to this headline">¶</a></h3>
<section id="list-the-backup-files">
<h4>List the backup files<a class="headerlink" href="#list-the-backup-files" title="Permalink to this headline">¶</a></h4>
<p>List the backup files needed on each node and save the list to a file.</p>
<p>If you are listing old backups from the new cluster use <code class="docutils literal notranslate"><span class="pre">--all-clusters</span></code> parameter.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sctool backup files -c cluster1 --snapshot-tag sm_20200513131519UTC \
--with-version \
--location s3:backup-bucket \
 &gt; backup_files.out
</pre></div>
</div>
<p>Snapshot information is now stored in <code class="docutils literal notranslate"><span class="pre">backup_files.out</span></code> file.
Each line of the <code class="docutils literal notranslate"><span class="pre">backup_files.out</span></code> file contains mapping between the path to the SSTable file in the backup bucket, and it’s mapping to keyspace/table.
If Scylla Manager is configured to store database schemas with the backups, then the first line in the file listing is the path to the schema archive.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>s3://backup-bucket/backup/sst/cluster/7313fda0-6ebd-4513-8af0-67ac8e30077b/dc/AWS_EU_CENTRAL_1/node/92de78b1-6c77-4788-b513-2fff5a178fe5/keyspace/user_data/table/data_65/a2667040944811eaaf9d000000000000/la-72-big-Index.db         user_data/data_65-a2667040944811eaaf9d000000000000
</pre></div>
</div>
<p>Path contains metadata, for example:</p>
<ul class="simple">
<li><p>Cluster ID - 7313fda0-6ebd-4513-8af0-67ac8e30077b</p></li>
<li><p>Data Center - AWS_EU_CENTRAL_1</p></li>
<li><p>Directory - /var/lib/scylla/data/user_data/data_65-a2667040944811eaaf9d000000000000/</p></li>
<li><p>Keyspace - user_data</p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sctool backup files -c prod-cluster --snapshot-tag sm_20191210145027UTC \
--with-version &gt; backup_files.out
</pre></div>
</div>
<p>Each line describes a backed-up file and where it should be downloaded. For example</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>s3://backups/backup/sst/cluster/1d781354-9f9f-47cc-ad45-f8f890569656/dc/dc1/node/ece658c2-e587-49a5-9fea-7b0992e19607/keyspace/auth_service/table/roles/5bc52802de2535edaeab188eecebb090/mc-2-big-CompressionInfo.db      auth_service/roles-5bc52802de2535edaeab188eecebb090
</pre></div>
</div>
<p>This file has to be copied to:</p>
<ul class="simple">
<li><p>Cluster - 1d781354-9f9f-47cc-ad45-f8f890569656</p></li>
<li><p>Data Center - dc1</p></li>
<li><p>Node - ece658c2-e587-49a5-9fea-7b0992e19607</p></li>
<li><p>Directory - /var/lib/scylla/data/auth_service/roles-5bc52802de2535edaeab188eecebb090/upload</p></li>
</ul>
</section>
<section id="download-the-backup-files">
<h4>Download the backup files<a class="headerlink" href="#download-the-backup-files" title="Permalink to this headline">¶</a></h4>
<p>This step must be executed on <strong>each node</strong> in the cluster.</p>
<ol class="arabic">
<li><p>Copy <code class="docutils literal notranslate"><span class="pre">backup_files.out</span></code> file as <code class="docutils literal notranslate"><span class="pre">/tmp/backup_files.out</span></code> on the node.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">nodetool</span> <span class="pre">status</span></code> to get to know the node ID.</p></li>
<li><p>Download data into table directories.
As the file is kept in S3 so we can use S3 CLI to download it (this step may be different with other storage providers).
Grep can be used to filter specific files to restore.
With node UUID we can filter files only for a single node.
With a keyspace name, we can filter files only for a single keyspace.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd /var/lib/scylla/data

# Filter only files for a single node.
grep ece658c2-e587-49a5-9fea-7b0992e19607 /tmp/backup_files.out | xargs -n2 aws s3 cp
</pre></div>
</div>
</li>
<li><p>Make sure that all files are owned by the Scylla user and group.
We must ensure that permissions are right after copy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo chown -R scylla:scylla /var/lib/scylla/data/user_data/
</pre></div>
</div>
</li>
<li><p>Start the Scylla nodes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo systemctl start scylla-server
</pre></div>
</div>
</li>
</ol>
</section>
<section id="repair">
<h4>Repair<a class="headerlink" href="#repair" title="Permalink to this headline">¶</a></h4>
<p>After performing the above on all nodes, repair the cluster with Scylla Manager Repair.
This makes sure that the data is consistent on all nodes and between each node.</p>
</section>
</section>
<section id="to-a-new-cluster">
<h3>To a new cluster<a class="headerlink" href="#to-a-new-cluster" title="Permalink to this headline">¶</a></h3>
<p>In order to restore a backup to a cluster that has a different topology, you have to use an external tool called <a class="reference internal" href="../../procedures/cassandra-to-scylla-migration-process.html"><span class="doc">sstableloader</span></a>.
This procedure is much slower than restoring to the same topology cluster.</p>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Start up the nodes if they are not running after schema restore:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo systemctl start scylla-server
</pre></div>
</div>
</li>
<li><p>List all the backup files and save the list to a file.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">--all-clusters</span></code> if you are restoring from the cluster that no longer exists.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sctool backup files -c cluster1 --snapshot-tag sm_20200513131519UTC --location s3:backup-bucket &gt; backup_files.out
</pre></div>
</div>
</li>
<li><p>Copy <code class="docutils literal notranslate"><span class="pre">backup_files.out</span></code> file as <code class="docutils literal notranslate"><span class="pre">/tmp/backup_files.out</span></code> on the host where <code class="docutils literal notranslate"><span class="pre">sstableloader</span></code> is installed.</p></li>
<li><p>Download all files created during backup into temporary location:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mkdir snapshot
cd snapshot
# Create temporary directory structure.
cat /tmp/backup_files.out | awk &#39;{print $2}&#39; | xargs mkdir -p
# Download snapshot files.
cat /tmp/backup_files.out | xargs -n2 aws s3 cp
</pre></div>
</div>
</li>
<li><p>Execute the following command for each table by providing a list of node IP addresses and path to sstable files on node that has sstableloader installed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Loads table user_data.data_0 into four node cluster.
sstableloader -d &#39;35.158.14.221,18.157.98.72,3.122.196.197,3.126.2.205&#39; ./user_data/data_0 --username scylla --password &lt;password&gt;
</pre></div>
</div>
</li>
</ol>
<p>After tables are restored, verify the validity of your data by running queries on your database.</p>
</section>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
    </div>
    <div class="navigation navigation--next">
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions"></div>
        <div class="side-nav__content">
            <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../getting-started/index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../getting-started/install-scylla/index.html">Install Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/install-scylla/scylla-web-installer.html">ScyllaDB Web Installer for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/install-scylla/unified-installer.html">Scylla Unified Installer (relocatable executable)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/install-scylla/air-gapped-install.html">Air-gapped Server Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/install-scylla/rpm-info.html">What is in each RPM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/install-scylla/disable-housekeeping.html">Scylla Housekeeping and how to disable it</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/install-scylla/dev-mod.html">Scylla Developer Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/install-scylla/config-commands.html">Scylla Configuration Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started/configure.html">Configure Scylla</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../getting-started/requirements.html">Scylla Requirements</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/system-requirements.html">System Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/os-support.html">OS Support by Platform and Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/scylla-in-a-shared-environment.html">Scylla in a Shared Environment</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../using-scylla/drivers/index.html">Scylla Drivers</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/drivers/cql-drivers/index.html">Scylla CQL Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/drivers/dynamo-drivers/index.html">Scylla DynamoDB Drivers</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../using-scylla/migrate-scylla.html">Migrate to Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../procedures/cassandra-to-scylla-migration-process.html">Migration Process from Cassandra to Scylla</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/cassandra-compatibility.html">Scylla and Apache Cassandra Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/mig-tool-review.html">Migration Tools Overview</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../using-scylla/integrations/index.html">Integration Solutions</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-spark.html">Integrate Scylla with Spark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-kairos.html">Integrate Scylla with KairosDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-presto.html">Integrate Scylla with Presto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-elasticsearch.html">Integrate Scylla with Elasticsearch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-k8.html">Integrate Scylla with Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-janus.html">Integrate Scylla with the JanusGraph Graph Data System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-datadog.html">Integrate Scylla with DataDog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-kafka.html">Integrate Scylla with Kafka</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-iota.html">Integrate Scylla with IOTA Chronicle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-spring.html">Integrate Scylla with Spring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/sink-kafka-connector.html">Shard-Aware Kafka Connector for Scylla</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-ansible.html">Install Scylla with Ansible</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/integrations/integration-databricks.html">Integrate Scylla with Databricks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started/tutorials.html">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../index.html">Scylla for Administrators</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../admin.html">Administration Guide</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../procedures/index.html">Procedures</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../procedures/cluster-management/index.html">Cluster Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../procedures/backup-restore/index.html">Backup &amp; Restore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../procedures/config-change/index.html">Change Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../procedures/maintenance/index.html">Maintenance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../procedures/tips/index.html">Best Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../benchmarking-scylla.html">Benchmarking Scylla</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../procedures/cassandra-to-scylla-migration-process.html">Migrate from Cassandra to Scylla</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/install-scylla/disable-housekeeping.html">Disable Housekeeping</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../security/index.html">Security</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/security-checklist.html">Scylla Security Checklist</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/authentication.html">Enable Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/runtime-authentication.html">Enable and Disable Authentication Without Downtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/gen-cqlsh-file.html">Generate a cqlshrc File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/password-reset.html">Reset Authenticator Password</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/enable-authorization.html">Enable Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/authorization.html">Grant Authorization CQL Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/rbac-usecase.html">Role Based Access Control (RBAC)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/auditing.html">Scylla Auditing Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/client-node-encryption.html">Encryption: Data in Transit Client to Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/node-node-encryption.html">Encryption: Data in Transit Node to Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/generate-certificate.html">Generating a self-signed Certificate Chain Using openssl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/encryption-at-rest.html">Encryption at Rest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/ldap-authentication.html">LDAP Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/ldap-authorization.html">LDAP Authorization (Role Management)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../admin-tools/index.html">Admin Tools</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../nodetool.html">Nodetool Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cql/cqlsh.html">CQLSh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rest.html">REST</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/tracing.html">Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/scylla-sstable.html">scylla-sstable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/scylla-types.html">scylla-types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/sstableloader.html">SSTableLoader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/cassandra-stress.html">cassandra-stress</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/sstabledump.html">SSTabledump</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/sstable2json.html">SSTable2json</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/sstable-index.html">SSTable Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/logging.html">Scylla Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/perftune.html">Seastar Perftune</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin-tools/virtual-tables.html">Virtual Tables</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../index.html">Scylla Manager</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label for="toctree-checkbox-11"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference external" href="https://manager.docs.scylladb.com">Scylla Manager Docs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade/upgrade-manager/index.html">Upgrade Scylla Manager</a></li>
<li class="toctree-l3"><a class="reference external" href="https://monitoring.docs.scylladb.com/stable/reference/matrix.html">Monitoring Support Matrix</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../monitoring/index.html">Scylla Monitoring Stack</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label for="toctree-checkbox-12"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference external" href="https://scylladb.github.io/scylla-monitoring">Latest Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade/upgrade-monitor/index.html">Upgrade Scylla Monitoring Stack</a></li>
<li class="toctree-l3"><a class="reference external" href="https://monitoring.docs.scylladb.com/stable/reference/matrix.html">Monitoring Support Matrix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../scylla-operator/index.html">Scylla Operator</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../upgrade/index.html">Upgrade Procedures</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label for="toctree-checkbox-13"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade/upgrade-enterprise/index.html">Scylla Enterprise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade/upgrade-opensource/index.html">Scylla Open Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade/upgrade-to-enterprise/index.html">Scylla Open Source to Scylla Enterprise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade/upgrade-manager/index.html">Scylla Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade/upgrade-monitor/index.html">Scylla Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade/ami-upgrade.html">Scylla AMI</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../system-configuration/index.html">System Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label for="toctree-checkbox-14"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started/system-configuration.html">System Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin.html">scylla.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../system-configuration/snitch.html">Scylla Snitches</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../benchmarking-scylla.html">Benchmarking Scylla</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../using-scylla/index.html">Scylla for Developers</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label for="toctree-checkbox-15"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../using-scylla/learn.html">Learn To Use Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label for="toctree-checkbox-16"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference external" href="https://university.scylladb.com/">Scylla University</a></li>
<li class="toctree-l3"><a class="reference external" href="https://university.scylladb.com/available-courses/">Course catalog</a></li>
<li class="toctree-l3"><a class="reference external" href="https://university.scylladb.com/courses/scylla-essentials-overview/">Scylla Essentials</a></li>
<li class="toctree-l3"><a class="reference external" href="https://university.scylladb.com/courses/data-modeling/lessons/basic-data-modeling-2/">Basic Data Modeling</a></li>
<li class="toctree-l3"><a class="reference external" href="https://university.scylladb.com/courses/data-modeling/lessons/advanced-data-modeling/">Advanced Data Modeling</a></li>
<li class="toctree-l3"><a class="reference external" href="https://university.scylladb.com/courses/the-mutant-monitoring-system-training-course/">MMS - Learn by Example</a></li>
<li class="toctree-l3"><a class="reference external" href="https://scylladb.github.io/care-pet/master/">Care-Pet an IoT Use Case and Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../using-scylla/alternator/index.html">Scylla Alternator</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../using-scylla/features.html">Scylla Features</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label for="toctree-checkbox-17"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/features-open-source.html">Scylla Open Source Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/features-ent.html">Scylla Enterprise Features</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../using-scylla/drivers/index.html">Scylla Drivers</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label for="toctree-checkbox-18"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/drivers/cql-drivers/index.html">Scylla CQL Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../using-scylla/drivers/dynamo-drivers/index.html">Scylla DynamoDB Drivers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cql/index.html">CQL Reference</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label for="toctree-checkbox-19"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/cqlsh.html">CQLSh: the CQL shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/appendices.html">Appendices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/compaction.html">Compaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/consistency.html">Consistency Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/ddl.html">Data Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/dml.html">Data Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/types.html">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/secondary-indexes.html">Global Secondary Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/secondary-indexes.html#additional-information">Additional Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/time-to-live.html">Expiring Data with Time to Live (TTL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/time-to-live.html#additional-information">Additional Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/json.html">JSON Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/mv.html">Materialized Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/non-reserved-keywords.html">Non-Reserved CQL Keywords</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/reserved-keywords.html">Reserved CQL Keywords</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cql/cql-extensions.html">ScyllaDB CQL Extensions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../architecture/index.html">Scylla Architecture</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label for="toctree-checkbox-20"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/ringarchitecture/index.html">Scylla Ring Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/architecture-fault-tolerance.html">Scylla Fault Tolerance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/console-CL-full-demo.html">Consistency Level Console Demo</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../architecture/anti-entropy/index.html">Scylla Anti-Entropy</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label for="toctree-checkbox-21"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/anti-entropy/hinted-handoff.html">Scylla Hinted Handoff</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/anti-entropy/read-repair.html">Scylla Read Repair</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../procedures/maintenance/repair.html">Scylla Repair</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../architecture/sstable/index.html">SSTable</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label for="toctree-checkbox-22"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/sstable/sstable2/index.html">Scylla SSTable - 2.x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/sstable/sstable3/index.html">Scylla SSTable - 3.x</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/compaction/compaction-strategies.html">Compaction Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/raft.html">Raft Consensus Algorithm in ScyllaDB</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../troubleshooting/index.html">Troubleshooting Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label for="toctree-checkbox-23"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../troubleshooting/support/index.html">Errors and Support</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label for="toctree-checkbox-24"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/report-scylla-problem.html">Report a Scylla problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/error-messages/index.html">Error Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/log-level.html">Change Log Level</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../troubleshooting/startup/index.html">Scylla Startup</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/><label for="toctree-checkbox-25"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/change-ownership.html">Ownership Problems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/scylla-wont-start.html">Scylla will not Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/python-error-no-module-named-yaml.html">Scylla Python Script broken</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../troubleshooting/cluster/index.html">Cluster and Node</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/><label for="toctree-checkbox-26"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/failed-decommission.html">Failed Decommission Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/timeouts.html">Cluster Timeouts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/node-joined-without-any-data.html">Node Joined With No Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/nodetool-memory-read-timeout.html">SocketTimeoutException</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/nodetool-nullpointerexception.html">NullPointerException</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../troubleshooting/modeling/index.html">Data Modeling</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/><label for="toctree-checkbox-27"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/large-partition-table.html">Scylla Large Partitions Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/large-rows-large-cells-tables.html">Scylla Large Rows and Cells Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/debugging-large-partition.html">Large Partitions Hunting</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../troubleshooting/storage/index.html">Data Storage and SSTables</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/><label for="toctree-checkbox-28"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/space-up.html">Space Utilization Increasing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/drop-table-space-up.html">Disk Space is not Reclaimed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/sstable-corruption.html">SSTable Corruption Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/pointless-compactions.html">Pointless Compactions</a></li>
<li class="toctree-l3"><a class="reference external" href="https://monitoring.docs.scylladb.com/stable/use-monitoring/advisor/heavyCompaction.html">Limiting Compaction</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../troubleshooting/CQL/index.html">CQL</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/><label for="toctree-checkbox-29"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/time-zone.html">Time Range Query Fails</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/copy-from-failed.html">COPY FROM Fails</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/clients-table.html">CQL Connection Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/reverse-queries.html">Reverse queries fail</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../troubleshooting/monitor/index.html">Scylla Monitor and Manager</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/><label for="toctree-checkbox-30"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/manager-monitoring-integration.html">Manager and Monitoring integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../troubleshooting/reverse-dns-sshd.html">Manager lists healthy nodes as down</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../kb/index.html">Knowledge Base</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/><label for="toctree-checkbox-31"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/cdc-experimental-upgrade.html">Upgrading from experimental CDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/compaction.html">Compaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/count-all-rows.html">Counting all rows in a table is slow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/cqlsh-more.html">CQL Query Does Not Display Entire Result Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/cqlsh-results.html">When CQLSh query returns partial results with followed by “More”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/custom-user.html">Run Scylla and supporting services as a custom user:group</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/decode-stack-trace.html">Decoding Stack Traces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/disk-utilization.html">Snapshots and Disk Utilization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/dpdk-hardware.html">DPDK mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/flamegraph.html">Debug your database with Flame Graphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/gc-grace-seconds.html">How to Change gc_grace_seconds for a Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/gossip.html">Gossip in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/increase-permission-cache.html">Increase Permission Cache to Avoid Non-paged Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/lwt-differences.html">How does Scylla LWT Differ from Apache Cassandra ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/map-cpu.html">Map CPUs to Scylla Shards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/memory-usage.html">Scylla Memory Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/ntp.html">NTP Configuration for Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/posix.html">POSIX networking for Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/quiz-administrators.html">Scylla consistency quiz for administrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/raid-device.html">Recreate RAID devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/rf-increase.html">How to Safely Increase the Replication Factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/scylla-and-spark-integration.html">Scylla and Spark integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/scylla-limits-systemd.html">Increase Scylla resource limits over systemd</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/seed-nodes.html">Scylla Seed Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/set-up-swap.html">How to Set up a Swap Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/snapshots.html">Scylla Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/static-columns.html">Scylla payload sent duplicated static columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/stop-local-repair.html">Stopping a local repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/system-limits.html">System Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/tombstones-flush.html">How to flush old tombstones from a table</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/ttl-facts.html">Time to Live (TTL) and Compaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/unresponsive-nodes.html">Scylla Nodes are Unresponsive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/update-pk.html">Update a Primary Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/use-perf.html">Using the perf utility with Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kb/yaml-address.html">Configure Scylla Networking with Multiple NIC/IP Combinations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://university.scylladb.com/">Scylla University</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">Scylla FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute.html">Contribute to Scylla</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../alternator/alternator.html">Alternator: DynamoDB API in Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/><label for="toctree-checkbox-32"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../alternator/getting-started.html">Getting Started With ScyllaDB Alternator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../alternator/compatibility.html">Scylla Alternator for DynamoDB users</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla/issues/new?title=Issue in page Restore a Backup&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://docs.scylladb.com/master/operating-scylla/manager/2.1/restore-a-backup%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/scylla/edit/master/docs/operating-scylla/manager/2.1/restore-a-backup.rst"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Restore a Backup</a><ul>
<li><a class="reference internal" href="#prepare-for-restore">Prepare for restore</a><ul>
<li><a class="reference internal" href="#make-sure-scylla-cluster-is-up">Make sure Scylla cluster is up</a></li>
<li><a class="reference internal" href="#install-scylla-manager">Install Scylla Manager</a></li>
<li><a class="reference internal" href="#register-the-cluster-with-the-scylla-manager">Register the cluster with the Scylla Manager</a></li>
<li><a class="reference internal" href="#identify-relevant-snapshot">Identify relevant snapshot</a></li>
<li><a class="reference internal" href="#restore-the-schema">Restore the schema</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upload-data-to-scylla">Upload data to Scylla</a><ul>
<li><a class="reference internal" href="#to-the-same-cluster">To the same cluster</a><ul>
<li><a class="reference internal" href="#list-the-backup-files">List the backup files</a></li>
<li><a class="reference internal" href="#download-the-backup-files">Download the backup files</a></li>
<li><a class="reference internal" href="#repair">Repair</a></li>
</ul>
</li>
<li><a class="reference internal" href="#to-a-new-cluster">To a new cluster</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../../../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../../../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../../../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 22 Jul 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>